<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Fetch File Stream</title>
  </head>
  <body>
    <script>
      async function fetchAndConvertByteStream(url) {
        try {
          // 使用 fetch API 获取数据
          let response = await fetch(url);

          // 检查请求是否成功
          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }

          // 将响应数据读取为 ArrayBuffer
          let arrayBuffer = await response.arrayBuffer();

          // 创建 DataView 用于读取 ArrayBuffer
          let dataView = new DataView(arrayBuffer);

          // 计算 float 数组的长度
          let floatArrayLength = arrayBuffer.byteLength / 4;

          // 创建一个数组存储 float 数据
          let floatArray = new Float32Array(floatArrayLength);

          // 将每4个字节转换为一个 float
          for (let i = 0; i < floatArrayLength; i++) {
            floatArray[i] = dataView.getFloat32(i * 4, true); // true 表示小端字节序
          }

          return floatArray;
        } catch (error) {
          console.error('Error fetching and processing data:', error);
        }
      }

      // 使用示例
      let url = 'http://192.168.23.199:8099/yard/stock/data/file?fileName=1_GridContent.txt';
      fetchAndConvertByteStream(url).then((floatArray) => {
        console.log('Float Array:', floatArray);
      });
    </script>
  </body>
</html>
